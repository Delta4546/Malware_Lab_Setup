
Dans ce readme je vais vous apprendre à setup un lab pour pouvoir analyser des virus avec Flare VM et REMnux.

## Topologie réseau 🌐

<img src="/img/topology.png" >

VM entièrement isoler du réseau qui ne pourrons pas avoir accès à internet et qui ne pourront que communiquer entre elle.

Notre première VM sera une VM Windows 10 avec **Flare VM** de installer dessus la seconde VM sera une VM **REMnux** qui est une distribution linux baser sur Ubuntu nous nous en servirons pour  simuler un sorte de "faux" internet avec l'outil **INetSim**.

## Prérequis 🐛

🔗 ~ [Windows 10 ISO](https://www.microsoft.com/en-us/software-download/windows10) 
🔗 ~ [REMnux ISO](https://remnux.org/?ltclid=#distro)
🔗 ~ [FlareVM](https://github.com/mandiant/flare-vm)  
🔗 ~ [Oracle VM VirtualBox](https://www.virtualbox.org/wiki/Downloads)

## Installation 🦋

Pour commencer nous allons devoir configurer nos machines sur Virtual Box.

### Windows VM 🪟

Importer le fichier **Windows.iso** dans Virtual Box en cliquant sur **le bouton Nouvelle**.
Ensuite configurer le nom et sélectionner votre .iso

![[1.png]]

Pour le nom d'utilisateur ça sera **User** et le mot de passe **erty** et le hostname **FlareVM**

![[2.png]]

Pour la **ram** je vous conseille un **minimum de 8GO** et pour le **processeur** vous pouvez allouer **quatre cœur physique** si votre processeur vous le permet.

![[3.png]]Pour la taille du disque pour votre VM je vous conseille au minimum 80GO 

![[4.png]]Cliquer ensuite sur **Finish** pour ajouter la VM

Sélectionner la VM Windows 10 cliquer sur le bouton **Configuration** puis cliquer sur l'onglet **Affichage** et pour le contrôleur graphique prendre **VBoxSVGA** et en dans Fonctions avancées **cochez activer l'accélérations 3D** dans mémoire vidéo mettez le maximum possible. 

![[10.png]]

Si Windows est votre système principal **désactivez Hyper-V** pour éviter tous conflit vous devez faire la touche **win + q** et dans l'onglet recherche écrire **Activer ou désactiver des fonctionnalités Windows** puis décocher **Plateforme de l'hyperviseur Windows**

![[11.png]]


### REMnux VM🐧

Ici pour REMnux c'est encore plus simple car comme c'est un .ova la VM est déjà configurer.
Cliquez sur la catégorie **Outils** puis cliquer sur le bouton **Importer** puis ajouter votre **fichier .ova**

![[5.png]]

Ensuite cliquez simplement sur **Suivant** et **Finish**


## Installer FlareVM et Configurer INetSim ⌨️

### Windows FlareVM Installation 🪟

Vous devez pour le processus d'installation de FlareVM **vous connecter à internet.**

Sélectionnez la VM Windows 10 puis cliquez sur le bouton **Configuration** puis cliquer sur l'onglet réseau et choisir pour mode d'accès réseau **l'accès par pont**

![[9.png]]

Ensuite lancer votre VM avec le bouton démarrer en vert.

**Télécharger de fichier .zip sur le repo github de Flare VM** ensuite il faut **unzip le zip** et déposer le fichier sur le bureau de votre VM Windows 10

![[12.png]]

![[13.png]]

Vous devez désactiver Windows Defender sur votre VM Windows 10 car il pourrais nuire à nos analyse de malware. Pour se faire rdv dans l'onglet recherche avec la touche **win + q** et chercher **sécurité Windows**. Puis cliquer sur **Protection contre les virus et menaces** et décocher tous. Pareil dans **Pare-Feu et protection du réseau**.

![[14.png]]

![[15.png]]

Maintenant que cella est fait lancer un Windows **PowerShell en mode administrateur**

![[16.png]]

maintenant vous devez vous rendre dans votre dossier flare-vm-main qui se trouve sur votre bureau. avec la commande `cd C:\Users\User\Desktop\flare-vm-main`
![[17.png]]

puis rentrer les commandes suivante à la suite 

`(New-Object net.webclient).DownloadFile('https://raw.githubusercontent.com/mandiant/flare-vm/main/install.ps1',"install.ps1")`

`Unblock-File .\install.ps1`

`Set-ExecutionPolicy Unrestricted -Force`

![[18.png]]

cliquer tous le temps sur **Y pour Yes**

Nous allons devoir choisir les paquets que nous voulons installer pour ma part je vais laisser par défaut je vais juste retirer **ghidra** et **notepad++** car je n'aime pas vraiment utiliser c'est deux logiciel. cliquer sur **tab** pour vous diriger sur le bouton entrer une fois dessus cliquer sur la touche **entrer** pour valider. 

![[24.png]]

Une fois l'installation terminer votre VM vas **redémarrer** 

### REMnux VM INetSim Configuration🐧

lancer un terminal et faite `setxkbmap fr` pour mettre votre clavier en Français

on vas devoir éditer le fichier de configuration de INetSim avec

`sudo nano /etc/inetsim/inetsim.conf`

décommenter la ligne **start service_dns**

![[19.png]]

décommenter la ligne service_bind_address et rentrer l'ipv4 **0.0.0.0** conformément à la documentation de REMnux

![[20 1.png]]

décommenter aussi ligne dns_default_ip et rentrer l'ipv4 de votre choix pour ma part je vais rentrer conformément à ma topologie **10.0.0.0** 

![[21.png]]

puis **ctrl + x** et **y** et la touche **entrer** pour sauvegarder le fichier  

entrer la commande pour désactiver le résolveur dns par défaut et utiliser celui de INetSim conformément à la documentation de REMnux 

`sudo systemctl disable systemd-resolved.service`

`sudo service systemd-resolved stop`
## Virtual Box configuration réseau 🔌

Dans cette section nous allons configurer nos deux VM pour faire en sorte qu'elle ne communique que entre elle et qu'elle n'on pas accès à internet. De ce fait aucun virus ne pourra venir infecter notre réseau.  Nous nous en tiendrons strictement à la topologie réseau vue précédemment.  

### Windows VM 🪟 

Dans Virtual Box sélectionner votre VM Windows 10 puis cliquez sur le **bouton Configuration**
et **sélectionnez la catégorie Réseau** et dans mode d'accès réseau choisir **réseau interne**
en name vous pouvez écrire ce que vous voulez pour ma part ça sera **malware**. 

![[6.png]]

Dans **Général** puis l'onglet **Avancer** bien vérifier que le presse-papier partagé et le glisser-déposer son bien en **Disable**

![[7.png]]

Enfin cliquer sur **ok** pour sauvegarder.

### REMnux VM🐧

Même chose **Configuration** puis **Réseau** sélectionner dans mode d'accès réseau prendre **réseau interne** et dans name sélectionner avec le menu déroulant le nom précédemment créer soit dans mon cas **malware**

![[8.png]] 

Aussi bien penser à vérifier dans **général** et l'onglet **avancer** que le presse papier partagé et le glisser déposer son bien en **Disable**

## OS configuration réseau 💻

### Windows VM 🪟 




### REMnux VM🐧

**ifconfig** pour voir le nom de mon interface réseau ici c'est **enp0s3**

![[22.png]]

Je vais maintenant configurer mon adresse ipv4 sous la forme **10.0.0.2** avec un masque de sous réseau en notation CIDR /24 soit  **255.255.255.0**

![[23.png]]


## Vérification configuration réseau 👍

