
Dans ce readme je vais vous apprendre Ã  setup un lab pour pouvoir analyser des virus avec Flare VM et REMnux.

## Topologie rÃ©seau ğŸŒ
<img src="/img/0.png" />


VM entiÃ¨rement isoler du rÃ©seau qui ne pourrons pas avoir accÃ¨s Ã  internet et qui ne pourront que communiquer entre elle.

Notre premiÃ¨re VM sera une VM Windows 10 avec **Flare VM** de installer dessus. 
La seconde VM sera une VM **REMnux** nous nous en servirons pour  simuler un sorte de "faux" internet avec l'outil **INetSim**.

## PrÃ©requis ğŸ›

ğŸ”— ~ [Windows 10 ISO](https://www.microsoft.com/en-us/software-download/windows10) 
ğŸ”— ~ [REMnux ISO](https://remnux.org/?ltclid=#distro)
ğŸ”— ~ [FlareVM](https://github.com/mandiant/flare-vm)  
ğŸ”— ~ [Oracle VM VirtualBox](https://www.virtualbox.org/wiki/Downloads)

## Installation ğŸ¦‹

Pour commencer nous allons devoir configurer nos machines sur Virtual Box.

### Windows VM ğŸªŸ

Importer le fichier **Windows.iso** dans Virtual Box en cliquant sur **le bouton Nouvelle**.
Ensuite configurer le nom et sÃ©lectionner votre .iso
<img src="/img/1.png" />


Pour le nom d'utilisateur Ã§a sera **vm** et le mot de passe **erty** et le hostname **FlareVM**
<img src="/img/2.png" />


Pour la **ram** je vous conseille un **minimum de 8GO** et pour le **processeur** vous pouvez allouer **quatre cÅ“ur physique** si votre processeur vous le permet.
<img src="/img/3.png" />
]Pour la taille du disque pour votre VM je vous conseille au minimum 80GO 
<img src="/img/4.png" />
Cliquer ensuite sur **Finish** pour ajouter la VM

SÃ©lectionner la VM Windows 10 cliquer sur le bouton **Configuration** puis cliquer sur l'onglet **Affichage** et pour le contrÃ´leur graphique prendre **VBoxSVGA** et en dans Fonctions avancÃ©es **cochez activer l'accÃ©lÃ©rations 3D** dans mÃ©moire vidÃ©o mettez le maximum possible. 
<img src="/img/5.png" />


Si Windows est votre systÃ¨me principal **dÃ©sactivez Hyper-V** pour Ã©viter tous conflit vous devez faire la touche **win + q** et dans l'onglet recherche Ã©crire **Activer ou dÃ©sactiver des fonctionnalitÃ©s Windows** puis dÃ©cocher **Plateforme de l'hyperviseur Windows**
<img src="/img/6.png" />



### REMnux VMğŸ§

Ici pour REMnux c'est encore plus simple car comme c'est un .ova la VM est dÃ©jÃ  configurer.
Cliquez sur la catÃ©gorie **Outils** puis cliquer sur le bouton **Importer** puis ajouter votre **fichier .ova**
<img src="/img/7.png" />


Ensuite cliquez simplement sur **Suivant** et **Finish**


## Installer FlareVM et Configurer INetSim âŒ¨ï¸

### Windows FlareVM Installation ğŸªŸ

Vous devez pour le processus d'installation de FlareVM **vous connecter Ã  internet.**

SÃ©lectionnez la VM Windows 10 puis cliquez sur le bouton **Configuration** puis cliquer sur l'onglet rÃ©seau et choisir pour mode d'accÃ¨s rÃ©seau **l'accÃ¨s par pont**
<img src="/img/8.png" />


Ensuite lancer votre VM avec le bouton dÃ©marrer en vert.

**TÃ©lÃ©charger de fichier .zip sur le repo github de Flare VM** ensuite il faut **unzip le zip** et dÃ©poser le fichier sur le bureau de votre VM Windows 10
<img src="/img/9.png" />

<img src="/img/10.png" />


Vous devez dÃ©sactiver Windows Defender sur votre VM Windows 10 car il pourrais nuire Ã  nos analyse de malware. Pour se faire rdv dans l'onglet recherche avec la touche **win + q** et chercher **sÃ©curitÃ© Windows**. Puis cliquer sur **Protection contre les virus et menaces** et dÃ©cocher tous. Pareil dans **Pare-Feu et protection du rÃ©seau**.
<img src="/img/11.png" />

<img src="/img/12.png" />


Maintenant que cella est fait lancer un Windows **PowerShell en mode administrateur**
<img src="/img/13.png" />


maintenant vous devez vous rendre dans votre dossier flare-vm-main qui se trouve sur votre bureau. avec la commande `cd C:\Users\User\Desktop\flare-vm-main`
<img src="/img/14.png" />


puis rentrer les commandes suivante Ã  la suite 

`(New-Object net.webclient).DownloadFile('https://raw.githubusercontent.com/mandiant/flare-vm/main/install.ps1',"install.ps1")`

`Unblock-File .\install.ps1`

`Set-ExecutionPolicy Unrestricted -Force`
<img src="/img/15.png" />


cliquer tous le temps sur **Y pour Yes**

Nous allons devoir choisir les paquets que nous voulons installer pour ma part je vais laisser par dÃ©faut je vais juste retirer **ghidra** et **notepad++** car je n'aime pas vraiment utiliser c'est deux logiciel. cliquer sur **tab** pour vous diriger sur le bouton entrer une fois dessus cliquer sur la touche **entrer** pour valider. 
<img src="/img/16.png" />


Une fois l'installation terminer votre VM vas **redÃ©marrer** et hop FlareVM est installer 
<img src="/img/17.png" />



### REMnux VM INetSim ConfigurationğŸ§

lancer un terminal et faite `setxkbmap fr` pour mettre votre clavier en FranÃ§ais

on vas devoir Ã©diter le fichier de configuration de INetSim avec

`sudo nano /etc/inetsim/inetsim.conf`

dÃ©commenter la ligne **start service_dns**
<img src="/img/18.png" />


dÃ©commenter la ligne service_bind_address et rentrer l'ipv4 **0.0.0.0** conformÃ©ment Ã  la documentation de REMnux
<img src="/img/19.png" />


dÃ©commenter aussi ligne dns_default_ip et rentrer l'ipv4 de votre choix pour ma part je vais rentrer conformÃ©ment Ã  ma topologie **10.0.0.2** 

<img src="/img/20.png" />



puis **ctrl + x** et **y** et la touche **entrer** pour sauvegarder le fichier  

entrer la commande pour dÃ©sactiver le rÃ©solveur dns par dÃ©faut et utiliser celui de INetSim conformÃ©ment Ã  la documentation de REMnux 

`sudo systemctl disable systemd-resolved.service`

`sudo service systemd-resolved stop`
## Virtual Box configuration rÃ©seau ğŸ”Œ

Dans cette section nous allons configurer nos deux VM pour faire en sorte qu'elle ne communique que entre elle et qu'elle n'on pas accÃ¨s Ã  internet. De ce fait aucun virus ne pourra venir infecter notre rÃ©seau.  Nous nous en tiendrons strictement Ã  la topologie rÃ©seau vue prÃ©cÃ©demment.  

### Windows VM ğŸªŸ 

Dans Virtual Box sÃ©lectionner votre VM Windows 10 puis cliquez sur le **bouton Configuration**
et **sÃ©lectionnez la catÃ©gorie RÃ©seau** et dans mode d'accÃ¨s rÃ©seau choisir **rÃ©seau interne**
en name vous pouvez Ã©crire ce que vous voulez pour ma part Ã§a sera **malware**. 
<img src="/img/21.png" />


Dans **GÃ©nÃ©ral** puis l'onglet **Avancer** bien vÃ©rifier que le presse-papier partagÃ© et le glisser-dÃ©poser son bien en **Disable**
<img src="/img/22.png" />


Enfin cliquer sur **ok** pour sauvegarder.

### REMnux VMğŸ§

MÃªme chose **Configuration** puis **RÃ©seau** sÃ©lectionner dans mode d'accÃ¨s rÃ©seau prendre **rÃ©seau interne** et dans name sÃ©lectionner avec le menu dÃ©roulant le nom prÃ©cÃ©demment crÃ©er soit dans mon cas **malware**
<img src="/img/23.png" />


Aussi bien penser Ã  vÃ©rifier dans **gÃ©nÃ©ral** et l'onglet **avancer** que le presse papier partagÃ© et le glisser dÃ©poser son bien en **Disable**

## OS configuration rÃ©seau ğŸ’»

### Windows VM ğŸªŸ 

Sur notre machine Windows nous allons passer directement par l'interface graphique pour assigner l'adresse IP et le masque correspondant Ã  notre schÃ©ma soit 

@IP : 10.0.0.1
@MAC : 255.255.255.0

Vous devez vous rendre dans les **ParamÃ¨tres > RÃ©seau et internet > Ethernet > modifier les options d'adaptateur > puis clique droit et propriÃ©tÃ©**
<img src="/img/24.png" />


et sÃ©lectionner **Protocol internet version 4 (TCP /IPv4)**
<img src="/img/25.png" />


maintenant il vous suffit de rentrer la mÃªme chose que moi et ensuite de cliquer sur ok
<img src="/img/26.png" />

### REMnux VMğŸ§

**ifconfig** pour voir le nom de mon interface rÃ©seau ici c'est **enp0s3**
<img src="/img/27.png" />


Sur notre machine REMnux nous allons passer par la ligne de commande (CLI) pour assigner l'adresse IP et le masque correspondant Ã  notre schÃ©ma soit 

@IP : 10.0.0.2
@MAC : 255.255.255.0

J'utilise la commande `sudo ip addr add 10.0.0.2/24 dev enp0s3` pour ajouter l'ip et le masque Ã  mon interface rÃ©seau correspondante
<img src="/img/28.png" />



## VÃ©rification configuration rÃ©seau ğŸ‘

On vas effectuer une sÃ©ries de ping de 

Windows --------> REMnux
REMnux ---------> Windows

parfait nos deux machines peuvent se ping de faÃ§on successive 
<img src="/img/29.png" width="900px"/>


on vas maintenant vÃ©rifier si **INetSim** (pour Internet Services Simulation Suite) fonctionne correctement pour rappelle  **INetSim** vas nous permettre "d'Ã©muler une fausse connexion Ã  internet sans Ãªtre rÃ©ellement connecter au rÃ©seau internet" ce qui vas nous permettre de pouvoir intercepter les requÃªtes DNS ou bien FTP etc...

On lance INetSim sur notre machine REMnux avec la commande 

`inetsim`
<img src="/img/30.png" />


si on se rend sur notre machine FlareVM et qu'on rentre 10.0.0.2 ou bien n'importe qu'elle nom de domaine on vois cela 
<img src="/img/31.png" width="1000px" />

<img src="/img/32.png" width="1000px" />


c'est donc bien configurer 

Aussi si vous voulez intercepter uniquement les requÃªtes DNS vous pouvez utiliser **fakedns** sur votre machine REMnux pour intercepter seulement les requÃªtes DNS de votre machine FlareVM.
<img src="/img/33.png" />


sinon avec INetSim si vous voulez pouvoir visualiser toutes les requÃªtes que vous avez intercepter vous devez utiliser le logiciel **wireshark** sur votre machine REMnux.

## Snapshot ğŸ“·

Je vous conseille d'effectuer une snapshot (instantanÃ© en franÃ§ais) de votre machine Windows FlareVM au cas ou vous la casser Ã  cause d'un virus ou d'une mauvaise manipulation cela pourra vous permettre de revenir Ã  un Ã©tat propre.

cliquer sur **machine > prendre un instantanÃ©
<img src="/img/34.png" />



Le tutoriel est maintenant terminer.

## Bonus ğŸ‘€

### TÃ©lÃ©charger des samples de malware

Si vous voulez des samples de malware vous pouvez vous rendre sur 

- https://vx-underground.org/Samples
- https://bazaar.abuse.ch/browse/

